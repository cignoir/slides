# テストについて

@cignoir

---

# ≠ テスト駆動開発の話
- 短いイテレーションにおいてどうテストを計画して実践するか
- 非開発者向け

---

## 結論
### このスライドで伝えたいことは2つ

- テストは難しいということ
- フリーデバッグ != 回帰テスト

---

## 略歴

- ネットに生まれてネットでつながる会社育ち
 - 「テストコードを書かないやつは死ね」な環境
 - 自動テスト1回 7時間
 - アジャイル・ペアプロ・テスト駆動開発を実践
 - 見積もりやテストの難しさを知り悩んだ

- ゲームサーバ開発時代
 - テスト駆動開発(BDD)

---

## ワークフローの例

- ◯◯という機能を実装
- 仕様を満たしてるかテスト
- ◯◯に修正を加えたので周辺の機能をテスト

---

# 素晴らしい

問題は1つだけ

---

# 完遂不能

---

## 補足
### Webやソシャゲ開発運営の特性も考慮

```
機会損失やデバッグコストを考慮した上で
やむを得ない理由で以下の運営判断は十分にあり得ると考えます

例)品質よりスケジュールを優先してリリース
バグが見つかってからバグ修正で後から対応
```

---

## Web系って楽？

---

## Web系って楽？
### NO

- 品質・時間・資源のトレードオフの配分が違うので単純に比較出来ません
- 例えばソシャゲでは品質を犠牲にする分、別の痛みが伴います

```
コンシューマ: 品質＞資源＞時間
ソシャゲ: 時間＞資源＞品質
```

---

## 「バグ多いな」
## 「デバッグ能力が低いな」

---

# すいませんでした

---

# 「あの人能力や経験や根性が足りないんじゃない？」

---

# すいませんでした

---

# 無能です

 無能なので、知恵と戦略を用いて
 組織的に問題を克服することを考えたい

---

## テストの種類(一部)

- 機能テスト
- 性能テスト
- ホワイトボックステスト
- ブラックボックステスト
- 単体テスト
- アルファテスト、ベータテスト
- 回帰テスト

---

## ワークフローの例

- ◯◯という機能を実装
- 仕様を満たしているかテスト
- 周辺の機能をテスト

---

## ワークフローの例

- ◯◯という機能を実装
- 仕様を満たしているかテスト→```機能テスト```
- 周辺の機能をテスト→```回帰テスト```

---

## 機能テスト…
## 回帰テスト…

？？？

---

## 機能試験(function test)

 機能試験は、規定した機能を果たすかどうかを試す－ Wikipedia

- 機能が仕様を満たしているかのテスト
- テスト項目が比較的少なく明確、かつ工数も少ない

 追加キャラ、追加スキルなど差分の機能のテストなど

---

## 回帰試験（regression test）

 プログラムを修正・変更した場合に、過去に実施したテストを再度実施することを
 回帰試験（regression test）又は退行テストという。
 修正前の試験に再度合格するかどうか、他の機能に影響与えていないかどうか、
 他の機能が動作するかどうかを確認する。
 － Wikipedia

- 何らかの修正が直接関係がないと思われるような既存の機能に影響
- 実際に見つかるリリース後のバグはほとんどがデグレ
 - 移植で難しいのは回帰テストのテストケースが膨大なこと

---

## フリーデバッグ != 回帰テスト

```
個人の経験と勘でどうにか出来るスケールじゃないです
難しいので、方針を明確にしてテストの計画を立てます
```

---

## 回帰テストが難しい理由

- テストケースが膨大（数千件～)で2, 3日で網羅するのは無理
- 修正の度にバグが混入する可能性があるため、修正がFixしないと二度手間三度手間になる

---

## 回帰テストが難しい理由
### どうするか

- テストケースが膨大
 - → 範囲を限定する


- 修正がFixしない限りバグが混入し続ける
 - → Fixするまで回帰テストをしない

---

## テストケースが膨大
### どうテスト範囲を限定するか

- 範囲を知るために仕様を洗い出す
 - ブラックボックス的 = 内部の条件分岐などは考慮せず、外から見える範囲で
- たとえば、洗いだした仕様をラベル管理
 (ノウハウの一元管理・可視化も兼ねる)

---

## テストケースが膨大
### 具体例
- 100円の石を購入出来る
 - [石][購入][課金]
- レベル1デス
 - [スキル][青魔法][即死][レベル]
- クリア報酬はインベントリが一杯ならプレゼントで付与する
 - [プレゼント][インベントリ][クリア][クエスト]

- プログラムの内部はそこまで厳密に分類されてない
- 情報を管理する側で分類するのはつらい
- 情報を利用する側が柔軟に分類出来ることに意味がある

---

### ラベル管理は
### シャワー浴びながら考えた案なので
### あまり鵜呑みにしないでください。

## 重要なのはテストケースの可視化

---

## Fixしない限りバグが混入
### Fixまで回帰テストしない ＝ 最強

 とは言え、リリース前日までFixしない現実もある

---

## Fixしてる仕様としてない仕様を分ける

Fixしてる仕様に関連する回帰テストから行う

### あとはやっぱり早めにFixさせるのが重要

---

## 網羅出来ない回帰テストの意味

- ヒトと時間は有限なので割り切りは必要
- 関連する仕様を導き出す精度を上げることで割り切っていい部分を見極める精度が上がる
 (前述の仕様のラベリングはその精度を上げるための案)

---

## フリーデバッグ != 回帰テスト

- 似ているようで違う
- フリーデバッグこそ計画的に行う必要がある

---

# ご清聴ありがとうございました
@cignoir
